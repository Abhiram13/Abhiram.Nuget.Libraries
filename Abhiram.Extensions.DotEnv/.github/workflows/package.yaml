name: Publish NuGet Package

on:
    push:
        branches: 
           - main

jobs:
    build_and_publish:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: write
        
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Setup .NET
              uses: actions/setup-dotnet@v4
              with:
                  dotnet-version: '8.0.x'

            - name: Restore dependencies
              run: dotnet restore

            - name: Build
              run: dotnet build --configuration Release --no-restore # This step is crucial!
              
            - name: Create NuGet packages
              run: dotnet pack --configuration Release --output . --no-build

            - name: Publish to GitHub Packages
              run: dotnet nuget push "*.nupkg" --source "https://nuget.pkg.github.com/Abhiram13/index.json" --api-key ${{ secrets.GITHUB_TOKEN }}